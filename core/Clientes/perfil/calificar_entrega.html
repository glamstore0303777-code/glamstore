{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calificar Entrega | Glam Store</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { margin: 0; font-family: 'Comic Neue', cursive, Arial, sans-serif; background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%); display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 2rem; }
    .container { background: white; padding: 2.5rem; border-radius: 20px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1); max-width: 550px; width: 100%; }

    h1 { color: #c2185b; font-size: 1.8rem; margin-bottom: 1rem; text-align: center; }
    .pedido-info { background: #fce4ec; padding: 1.2rem; border-radius: 10px; margin: 1.5rem 0; border-left: 4px solid #f48fb1; }
    .pedido-info p { margin: 0.4rem 0; color: #666; font-size: 0.95rem; }
    .pedido-info strong { color: #c2185b; }
    .form-group { margin-bottom: 1.5rem; }
    .form-group label { display: block; margin-bottom: 0.5rem; color: #c2185b; font-weight: bold; font-size: 1rem; }
    .form-group small { color: #999; font-size: 0.85rem; display: block; margin-top: 0.3rem; }
    .star-rating { display: flex; gap: 0.5rem; justify-content: center; margin: 1rem 0; }
    .star-rating input { display: none; }
    .star-rating label { font-size: 2.5rem; color: #ddd; cursor: pointer; transition: all 0.2s ease; }
    .star-rating label:hover, .star-rating label:hover ~ label, .star-rating input:checked ~ label { color: #ffc107; }
    .star-rating { flex-direction: row-reverse; justify-content: flex-end; }
    .star-rating input:checked ~ label { color: #ffc107; }
    .file-input { width: 100%; padding: 1rem; border: 2px dashed #f8bbd0; border-radius: 15px; background: #fffafc; text-align: center; cursor: pointer; transition: all 0.3s ease; }
    .file-input:hover { border-color: #f48fb1; background: #fce4ec; }
    .file-input input { display: none; }
    .file-input .icon-upload { font-size: 2rem; margin-bottom: 0.5rem; }
    .file-input p { color: #666; margin: 0; }
    .preview-container { margin-top: 1rem; text-align: center; display: none; }
    .preview-container img { max-width: 100%; max-height: 200px; border-radius: 10px; border: 2px solid #f8bbd0; }
    textarea { width: 100%; padding: 1rem; border: 2px solid #f8bbd0; border-radius: 15px; font-family: inherit; font-size: 1rem; resize: vertical; min-height: 80px; }
    textarea:focus { outline: none; border-color: #f48fb1; }
    .btn { width: 100%; padding: 1rem; border-radius: 25px; font-weight: bold; font-size: 1.1rem; cursor: pointer; border: none; font-family: inherit; transition: all 0.3s ease; }
    .btn-primary { background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%); color: white; box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3); }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4); }
    .back-link { display: block; margin-top: 1.5rem; color: #c2185b; text-decoration: none; font-weight: bold; text-align: center; }
    .back-link:hover { text-decoration: underline; }
    .repartidor-info { background: #e8f5e9; padding: 1rem; border-radius: 10px; margin-bottom: 1.5rem; text-align: center; }
    .repartidor-info p { margin: 0.3rem 0; color: #2e7d32; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Califica tu Entrega</h1>
    
    <div class="pedido-info">
      <p><strong>Pedido #{{ pedido.idPedido }}</strong></p>
      <p>Total: <strong>${{ pedido.total|floatformat:0|intcomma }}</strong></p>
      <p>Fecha: <strong>{{ pedido.fechaCreacion|date:"d/m/Y" }}</strong></p>
    </div>
    
    {% if pedido.idRepartidor %}
    <div class="repartidor-info">
      <p style="font-size: 1.1rem; margin-bottom: 0.5rem;"><strong>Datos del Repartidor</strong></p>
      <p><strong>Nombre:</strong> {{ pedido.idRepartidor.nombreRepartidor }}</p>
      {% if pedido.idRepartidor.telefono %}
      <p><strong>Telefono:</strong> {{ pedido.idRepartidor.telefono }}</p>
      {% endif %}
      {% if pedido.idRepartidor.vehiculo %}
      <p><strong>Vehiculo:</strong> {{ pedido.idRepartidor.vehiculo }}</p>
      {% endif %}
    </div>
    {% else %}
    <div class="repartidor-info" style="background: #fff3e0; border-left: 4px solid #ff9800;">
      <p style="color: #e65100;"><strong>Sin repartidor asignado</strong></p>
    </div>
    {% endif %}
    
    <form method="POST" enctype="multipart/form-data">
      {% csrf_token %}
      
      <div class="form-group">
        <label>¿Como calificarias la entrega?</label>
        <div class="star-rating">
          <input type="radio" id="star5" name="calificacion" value="5" checked>
          <label for="star5">★</label>
          <input type="radio" id="star4" name="calificacion" value="4">
          <label for="star4">★</label>
          <input type="radio" id="star3" name="calificacion" value="3">
          <label for="star3">★</label>
          <input type="radio" id="star2" name="calificacion" value="2">
          <label for="star2">★</label>
          <input type="radio" id="star1" name="calificacion" value="1">
          <label for="star1">★</label>
        </div>
      </div>
      
      <div class="form-group">
        <label>Sube una foto con el repartidor (opcional)</label>
        <label class="file-input" for="foto_entrega">
          <div class="icon-upload" style="color: #c2185b; font-weight: bold;">[ Subir Foto ]</div>
          <p>Haz clic para seleccionar una foto</p>
          <input type="file" id="foto_entrega" name="foto_entrega" accept="image/*">
        </label>
        <div class="preview-container" id="preview-container">
          <img id="preview-image" src="" alt="Vista previa">
        </div>
        <small>Sube una foto tuya con el repartidor para verificar la entrega</small>
      </div>
      
      <div class="form-group">
        <label for="comentario">Comentario (opcional)</label>
        <textarea id="comentario" name="comentario" placeholder="Escribe un comentario sobre tu experiencia..."></textarea>
      </div>
      
      <button type="submit" class="btn btn-primary">Confirmar y Calificar</button>
    </form>
    
    <a href="{% url 'perfil' %}" class="back-link">Volver al Perfil</a>
  </div>
  
  <script>
    document.getElementById('foto_entrega').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('preview-image').src = e.target.result;
          document.getElementById('preview-container').style.display = 'block';
          document.querySelector('.file-input p').textContent = file.name;
        };
        reader.readAsDataURL(file);
      }
    });
  </script>
</body>
</html>
