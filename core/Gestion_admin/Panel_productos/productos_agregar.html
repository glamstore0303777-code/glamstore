{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Agregar Producto — Glam Store</title>
  <link rel="icon" href="{% static 'img/logoglam.png' %}">
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{% static 'css/admin_panel.css' %}">
  <script>
    function loadSubcategorias() {
      const categoriaId = document.getElementById('idCategoria').value;
      const subcategoriaSelect = document.getElementById('idSubcategoria');
      subcategoriaSelect.innerHTML = '<option value="">Cargando...</option>';
      if (categoriaId) {
        fetch(`/gestion/api/subcategorias/${categoriaId}/`)
          .then(response => response.json())
          .then(data => {
            subcategoriaSelect.innerHTML = '<option value="">-- Seleccionar Subcategoría (Opcional) --</option>';
            data.forEach(sub => {
              subcategoriaSelect.innerHTML += `<option value="${sub.id}">${sub.nombre}</option>`;
            });
          })
          .catch(() => {
            subcategoriaSelect.innerHTML = '<option value="">Error al cargar</option>';
          });
      } else {
        subcategoriaSelect.innerHTML = '<option value="">-- Primero selecciona una categoría --</option>';
      }
    }
  </script>
</head>
<body>
  <div class="sidebar">
    <div class="sidebar-header"><h2>Admin Glam</h2><p>Panel de Control</p></div>
    <div class="sidebar-user"><p>{{ request.session.usuario_nombre }}</p><p class="rol">Administrador</p></div>
    <div class="sidebar-nav">
      <a href="{% url 'dashboard_admin' %}">Dashboard</a>
      <a href="{% url 'lista_admin' %}">Mi Perfil</a>
      <a href="{% url 'lista_clientes' %}">Clientes</a>
      <a href="{% url 'lista_distribuidores' %}">Distribuidores</a>
      <a href="{% url 'lista_pedidos' %}">Pedidos</a>
      <a href="{% url 'lista_productos' %}" class="active">Productos</a>
      <a href="{% url 'lista_repartidores' %}">Repartidores</a>
      <a href="{% url 'lista_categorias' %}">Categorías</a>
      <a href="{% url 'lista_subcategorias' %}">Subcategorías</a>
    </div>
    <div class="sidebar-footer"><a href="{% url 'logout' %}">Cerrar Sesión</a></div>
  </div>
  <div class="main-content">
    <div class="page-header"><h1>Agregar Producto</h1></div>
    <div class="card">
      <div class="form-container">
        <div class="form-help">
          <p>Completa todos los campos para agregar un nuevo producto al catálogo. Los campos marcados con * son obligatorios.</p>
        </div>
        <form method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="form-row">
            <div class="form-group required-field">
              <label>Nombre del Producto</label>
              <input type="text" name="nombreProducto" required maxlength="50" placeholder="Ej: Labial Mate Rosa">
            </div>
            <div class="form-group required-field">
              <label>Precio</label>
              <input type="number" name="precio" step="0.01" required placeholder="0.00" min="0">
              <small>Precio en dólares (USD)</small>
            </div>
          </div>
          
          <div class="form-group">
            <label>Descripción</label>
            <textarea name="descripcion" placeholder="Describe las características del producto, beneficios, modo de uso..."></textarea>
          </div>
          
          <div class="form-row">
            <div class="form-group required-field">
              <label>Stock</label>
              <input type="number" name="stock" required min="0" placeholder="0">
              <small>Cantidad inicial en inventario</small>
            </div>
            <div class="form-group required-field">
              <label>Categoría</label>
              <select name="idCategoria" id="idCategoria" required onchange="loadSubcategorias()">
                <option value="">-- Seleccionar Categoría --</option>
                {% for categoria in categorias %}
                  <option value="{{ categoria.idCategoria }}">{{ categoria.nombreCategoria }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label>Subcategoría (Opcional)</label>
            <select name="idSubcategoria" id="idSubcategoria">
              <option value="">-- Primero selecciona una categoría --</option>
            </select>
            <small>Las subcategorías se cargan automáticamente según la categoría seleccionada</small>
          </div>
          
          <div class="form-group">
            <label>Imagen del Producto</label>
            <input type="file" name="imagen" accept="image/*">
            <small>Formatos permitidos: JPG, PNG, GIF. Tamaño máximo: 5MB. Recomendado: 500x500px</small>
          </div>
          
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Guardar Producto</button>
            <a href="{% url 'lista_productos' %}" class="btn btn-secondary">Cancelar</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</body>
</html>
