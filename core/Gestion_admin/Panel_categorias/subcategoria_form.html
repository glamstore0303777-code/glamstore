{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{{ action }} Subcategoría | Glam Store</title>
    <link rel="icon" href="{% static 'img/logoglam.png' %}">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/admin_panel.css' %}">
</head>
<body>
  <div class="sidebar">
    <div class="sidebar-header">
      <h2>Admin Glam</h2>
      <p>Panel de Control</p>
    </div>
    <div class="sidebar-user">
      <p>{{ request.session.usuario_nombre }}</p>
      <p class="rol">Administrador</p>
    </div>
    <div class="sidebar-nav">
      <a href="{% url 'dashboard_admin' %}">Dashboard</a>
      <a href="{% url 'lista_admin' %}">Mi Perfil</a>
      <a href="{% url 'lista_clientes' %}">Clientes</a>
      <a href="{% url 'lista_distribuidores' %}">Distribuidores</a>
      <a href="{% url 'lista_pedidos' %}">Pedidos</a>
      <a href="{% url 'lista_productos' %}">Productos</a>
      <a href="{% url 'lista_repartidores' %}">Repartidores</a>
      <a href="{% url 'lista_categorias' %}">Categorías</a>
      <a href="{% url 'lista_subcategorias' %}" class="active">Subcategorías</a>
    </div>
    <div class="sidebar-footer">
      <a href="{% url 'logout' %}">Cerrar Sesión</a>
    </div>
  </div>
  
  <div class="main-content">
    <div class="page-header">
      <h1>{{ action }} Subcategoría</h1>
    </div>
    
    <div class="card">
      <div class="form-container">
        <div class="form-help">
          <p>{% if action == 'Agregar' %}Completa los datos para crear una nueva subcategoría.{% else %}Modifica los datos de la subcategoría.{% endif %} Los campos marcados con * son obligatorios.</p>
        </div>
        
        <form method="post">
          {% csrf_token %}
          
          <div class="form-group required-field">
            <label for="nombreSubcategoria">Nombre de la Subcategoría</label>
            <input type="text" id="nombreSubcategoria" name="nombreSubcategoria" value="{{ form_object.nombreSubcategoria }}" required maxlength="50" placeholder="Ej: Labiales Mate">
          </div>

          <div class="form-group required-field">
            <label for="idCategoria">Categoría Padre</label>
            <select id="idCategoria" name="idCategoria" required>
              <option value="">-- Seleccionar Categoría --</option>
              {% for categoria in categorias %}
                <option value="{{ categoria.idCategoria }}" 
                        {% if form_object.idCategoria.idCategoria == categoria.idCategoria %}selected{% endif %}>
                  {{ categoria.nombreCategoria }}
                </option>
              {% endfor %}
            </select>
            <small>La subcategoría pertenecerá a esta categoría principal</small>
          </div>
          
          <div class="form-group">
            <label for="descripcion">Descripción (Opcional)</label>
            <textarea id="descripcion" name="descripcion" placeholder="Describe qué tipo de productos incluye esta subcategoría...">{{ form_object.descripcion }}</textarea>
          </div>
          
          <div class="subcategory-preview" id="preview" style="display: none;">
            <h3>Vista Previa</h3>
            <p><strong>Nombre:</strong> <span id="preview-name">-</span></p>
            <p><strong>Categoría:</strong> <span id="preview-category">-</span></p>
            <p><strong>Descripción:</strong> <span id="preview-description">Sin descripción</span></p>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary">{% if action == 'Agregar' %}Crear Subcategoría{% else %}Guardar Cambios{% endif %}</button>
            <a href="{% url 'lista_subcategorias' %}" class="btn btn-secondary">Cancelar</a>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <script>
    // Vista previa dinámica
    function updatePreview() {
      const name = document.getElementById('nombreSubcategoria').value;
      const categorySelect = document.getElementById('idCategoria');
      const categoryText = categorySelect.options[categorySelect.selectedIndex].text;
      const description = document.getElementById('descripcion').value;
      const preview = document.getElementById('preview');
      
      if (name || categorySelect.value || description) {
        preview.style.display = 'block';
        document.getElementById('preview-name').textContent = name || '-';
        document.getElementById('preview-category').textContent = categorySelect.value ? categoryText : '-';
        document.getElementById('preview-description').textContent = description || 'Sin descripción';
      } else {
        preview.style.display = 'none';
      }
    }
    
    // Agregar event listeners
    document.getElementById('nombreSubcategoria').addEventListener('input', updatePreview);
    document.getElementById('idCategoria').addEventListener('change', updatePreview);
    document.getElementById('descripcion').addEventListener('input', updatePreview);
    
    // Actualizar vista previa al cargar la página si hay datos
    document.addEventListener('DOMContentLoaded', updatePreview);
  </script>
</body>
</html>